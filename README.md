# SHORK Mini

A minimal Linux distribution developed originally from [FLOPPINUX's](https://github.com/w84death/floppinux) instructions. The aim is to make something very lean but functional for my mid-'90s IBM ThinkPads. Whilst FLOPPINUX and [Action Retro's video on it](https://www.youtube.com/watch?v=SiHZbnFrHOY) were a neat basis to start with, it no longer provides a floppy diskette image. A raw disk drive image is instead made as my scope includes more utilities and functionality. This repo stores my ideal configurations and largely automates the setup and compilation process.

## Usage

On Arch-based or Debian-based Linux, just run `setup.sh`. Once it has finished, a `build` directory with a `shorkmini.img` disk image file inside should be present and ready to be imaged onto a real disk drive.

## Capabilities

### Commands from BusyBox

* TODO

### Commands from included software

* ftp (FTP client, tnftp)
* nano (text editor)
* scp (SCP client, Dropbear)
* ssh (SSH client, Dropbear)

### Commands for my custom tools 

* sfetch (minimal "neofetch" clone)

## Overall process

1. Installs needed packages on the host system (user is prompted to choose Arch or Debian-based).
2. An i486 musl cross-compiler is downloaded and extracted.
3. ncurses source is downloaded and compiled. This is a prerequisite for other program compilations (e.g., nano).
4. Linux kernel source is downloaded and compiled. `configs/linux.config` is copied during this process. The configuration is tailored to provide the minimum for 486SX, PATA/SATA and networking. The output is `build/bzImage`.
4. BusyBox source is downloaded and compiled. `configs/busybox.config` is copied during this process. BusyBox provides common Unix-style utilities in one executable.
5. BusyBox's compilation is used to assemble a root file system in `build/root`. All files in `sysfiles` are copied into their appropriate locations.
6. Any other programs I desire are downloaded and compiled. Currently, this includes: nano, tnftp and Dropbear.
7. A raw hard drive image is created, containing the kernel image and the aforementioned file system.
8. `qemu-img` is used to create a copy that is converted to VMware format (`.vmdk`) for testing.

## Scripts

* `setup.sh`: Contains the complete download and compilation process that reproduces a `shorkmini.img` disk drive image.

    * `-m` and `--minimal` parameters can be used to skip to assembling the file system. This is useful if making changes to just `sysfiles`.
    * `-sp` and `--skip-prerequisites` parameters can be used to skip downloading host system prerequisite packages.
    * `-sk` and `--skip-kernel` parameters can be used to skip downloading and compiling the kernel.
    * `-sb` and `--skip-busybox` parameters can be used to skip downloading and compiling BusyBox.

* `clean.sh`: Deletes anything that is downloaded, created or generated by `setup.sh`.

* `common.sh`: Contains some useful variables and functions for `setup.sh`. This does nothing if you try to execute it.

## Directories

* `configs`: Contains my Linux kernel and BusyBox `.config` files that are copied into their respective source code directories before compilation, and a helper when compiling a binary that should be static not dynamic.

* `sysfiles`: Contains important system files to be copied into the Linux root file system before zipping.

## Adjustments

### Green terminal

If you do not want the terminal environment to always be green-on-black, do the following, then run `setup.sh`:

* In `sysfiles/profile`, replace the line `export PS1='\033[32m\033[40m\w$ '` with `export PS1='w$ '"`.
* In `sysfiles/rc`, remove/comment out the line `printf '\033[32m\033[40m'` and replace the line `export PS1='\033[32m\033[40m\w$ '` with `export PS1='w$ '"`.
* In `sysfiles/terminfo.src`, replace `sgr0=\E[0m\E[32m\E[40m` with `sgr0=\E[0m`.

## Notice & disclaimers

Running `setup.sh` will automatically perform several tasks on the host computer, including enabling 32-bit packages (Debian), installing prerequisite packages, modifying the PATH, and creating some environment variables. If you intend to use this yourself, please note that this is tailored for my personal usage. Please review what the script does to ensure it does not conflict with your existing configuration.

Running `clean.sh` will delete everything `setup.sh` made, including the `build` folder and its contents.
